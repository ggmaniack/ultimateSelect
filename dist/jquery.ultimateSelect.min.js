/*!*
 * jQuery ultimateSelect - A cosmetic, styleable replacement for SELECT elements
 *
 * Licensed under the MIT license: http://opensource.org/licenses/MIT
 *
 * @Author: Mihai Ionut Vilcu
 * @version v1.3.0
 * @url https://github.com/ionutvmi/ultimateSelect
 */
!function(e,t,l){"use strict";var a=e(t),i=e(l),s=e(l.body),n=t.UltimateSelect=function(e,t){if(e instanceof jQuery){if(!(e.length>0))return;e=e[0]}t=this.getSettings(t),this.typeTimer=null,this.typeSearch="",this.isMac=navigator.platform.match(/mac/i),this.selectElement=e,(t.mobile||!t.isMobile())&&"select"===e.tagName.toLowerCase()&&this.init(t)};n.prototype.version="1.3.0",n.prototype.init=function(t){var i=e(this.selectElement);if(i.data("ultimateSelect-control"))return!1;t=t||{};var s,n=e('<div class="ultimateSelect" />'),o=i.attr("multiple")||parseInt(i.attr("size"),10)>1,c=parseInt(i.prop("tabindex"),10)||0,r=t.isMobile(),u=r&&"native"===t.mobileBehaviour,d=this;if(n.addClass(i.attr("class")).attr("title",i.attr("title")||"").attr("tabindex",c).bind("focus.ultimateSelect",function(){this!==l.activeElement&&l.body!==l.activeElement&&e(l.activeElement).blur(),n.hasClass("ultimateSelect-active")||(n.addClass("ultimateSelect-active"),i.trigger("focus"))}).bind("blur.ultimateSelect",function(){n.hasClass("ultimateSelect-active")&&(n.removeClass("ultimateSelect-active"),i.trigger("blur"))}),a.data("ultimateSelect-bindings")||a.data("ultimateSelect-bindings",!0).bind("scroll.ultimateSelect",t.hideOnWindowScroll?this.hideMenus:e.noop).bind("resize.ultimateSelect",this.hideMenus),i.attr("disabled")&&n.addClass("ultimateSelect-disabled"),i.bind("click.ultimateSelect",function(e){u||(n.focus(),e.preventDefault())}),o){if(s=this.getOptions("inline"),n.append(s).data("ultimateSelect-options",s).addClass("ultimateSelect-inline ultimateSelect-menuShowing"),u||n.bind("keydown.ultimateSelect",function(e){d.handleKeyDown(e)}).bind("keypress.ultimateSelect",function(e){d.handleKeyPress(e)}).bind("click.ultimateSelect",function(t){1===t.which&&(e(t.target).is("A.ultimateSelect-inline")&&t.preventDefault(),n.hasClass("ultimateSelect-focus")||n.focus())}),n.insertAfter(i),!i[0].style.height){var p=i.attr("size")?parseInt(i.attr("size"),10):5,m=n.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");m.find(".ultimateSelect-options").html("<li><a> </a></li>");var h=parseInt(m.find(".ultimateSelect-options A:first").html("&nbsp;").outerHeight(),10);m.remove(),n.height(h*p)}this.disableSelection(n)}else{var S=e('<span class="ultimateSelect-label" />'),f=e('<span class="ultimateSelect-arrow" />');S.attr("class",this.getLabelClass()).text(this.getLabelText()),s=this.getOptions("dropdown"),s.appendTo("BODY"),n.data("ultimateSelect-options",s).addClass("ultimateSelect-dropdown").append(S).append(f),u||n.bind("click.ultimateSelect",function(e){n.hasClass("ultimateSelect-menuShowing")?d.hideMenus():(e.stopPropagation(),d.showMenu())}).bind("keydown.ultimateSelect",function(e){d.handleKeyDown(e)}).bind("keypress.ultimateSelect",function(e){d.handleKeyPress(e)}).bind("open.ultimateSelect",function(e,t){t&&t._ultimateSelect===!0||d.showMenu()}).bind("close.ultimateSelect",function(e,t){t&&t._ultimateSelect===!0||d.hideMenus()}),n.insertAfter(i),this.disableSelection(n)}i.addClass("ultimateSelect").data("ultimateSelect-control",n).data("ultimateSelect-settings",t),i.prependTo(n),u&&(n.addClass("ultimateSelect-mobile-native"),i.on("change",function(){d.refresh()})),this.hideSelect()},n.prototype.getOptions=function(t){var l,a=e(this.selectElement),i=this,s=function(t,l){return t.children("OPTION, OPTGROUP").each(function(){if(e(this).is("OPTION"))e(this).length>0?i.generateOptions(e(this),l):l.append("<li> </li>");else{var t=e('<li class="ultimateSelect-optgroup" />');t.text(e(this).attr("label")),l.append(t),l=s(e(this),l)}}),l};switch(t){case"inline":return l=e('<ul class="ultimateSelect-options" />'),l=s(a,l),l.find("A").bind("click.ultimateSelect",function(t){t.preventDefault(),a.ultimateSelect("control").hasClass("ultimateSelect-active")||a.ultimateSelect("control").focus(),i.hideMenus(),i.selectOption(e(this).parent(),t)}),this.disableSelection(l),l;case"dropdown":l=e('<ul class="ultimateSelect-dropdown-menu ultimateSelect-options" />'),l=s(a,l),l.data("ultimateSelect-select",a).css("display","none").appendTo("BODY").find("A").bind("click.ultimateSelect",function(){i.selectOption(e(this).parent()),i.hideMenus()});var n=a.attr("class")||"";if(""!==n){n=n.split(" ");for(var o=0;o<n.length;o++)l.addClass(n[o]+"-ultimateSelect-dropdown-menu")}return this.disableSelection(l),l}},n.prototype.getLabelClass=function(){var t=e(this.selectElement).find("OPTION:selected");return("ultimateSelect-label "+(t.attr("class")||"")).replace(/\s+$/,"")},n.prototype.getLabelText=function(){var t=e(this.selectElement).find("OPTION:selected");return t.text()||" "},n.prototype.setLabel=function(){var t=e(this.selectElement),l=t.data("ultimateSelect-control");l&&l.find(".ultimateSelect-label").attr("class",this.getLabelClass()).text(this.getLabelText())},n.prototype.destroy=function(){var t=e(this.selectElement),l=t.data("ultimateSelect-control");if(l){t.removeClass("ultimateSelect").removeData("ultimateSelect-control").data("ultimateSelect-control",null).removeData("ultimateSelect-settings").data("ultimateSelect-settings",null).insertBefore(l);var a=l.data("ultimateSelect-options");a.remove(),l.remove(),this.showSelect()}},n.prototype.refresh=function(){var t,l=e(this.selectElement),a=l.data("ultimateSelect-control"),i=a.hasClass("ultimateSelect-dropdown")?"dropdown":"inline";switch(a.data("ultimateSelect-options").remove(),t=this.getOptions(i),a.data("ultimateSelect-options",t),i){case"inline":a.append(t);break;case"dropdown":this.setLabel(),s.append(t)}"dropdown"===i&&a.hasClass("ultimateSelect-menuShowing")&&this.showMenu()},n.prototype.showMenu=function(){var t=this,l=e(this.selectElement),s=l.data("ultimateSelect-control"),n=l.data("ultimateSelect-settings"),o=n.isMobile()&&"native"===n.mobileBehaviour,c=s.data("ultimateSelect-options");if(s.hasClass("ultimateSelect-disabled")||o)return!1;this.hideMenus();var r=parseInt(s.css("borderBottomWidth"),10)||0,u=parseInt(s.css("borderTopWidth"),10)||0,d=s.offset(),p=n.topPositionCorrelation||0,m=n.bottomPositionCorrelation||0,h=c.outerHeight(),S=s.outerHeight(),f=parseInt(c.css("max-height"),10),b=a.scrollTop(),g=d.top-b,v=a.height()-(g+S),w=g>v&&(null===n.keepInViewport?!0:n.keepInViewport),C=w?d.top-h+u+p:d.top+S-r-m;if(f>g&&f>v){var y;w?(y=f-(g-5),c.css({"max-height":f-y+"px"}),C+=y):(y=f-(v-5),c.css({"max-height":f-y+"px"}))}if(c.data("posTop",w),c.width(s.innerWidth()).css({top:C,left:s.offset().left}).addClass("ultimateSelect-options ultimateSelect-options-"+(w?"top":"bottom")),l.triggerHandler("beforeopen"))return!1;var k=function(){l.triggerHandler("open",{_ultimateSelect:!0})};switch(n.menuTransition){case"fade":c.fadeIn(n.menuSpeed,k);break;case"slide":c.slideDown(n.menuSpeed,k);break;default:c.show(n.menuSpeed,k)}n.menuSpeed||k();var O=c.find(".ultimateSelect-selected:first");this.keepOptionInView(O,!0),s.addClass("ultimateSelect-menuShowing ultimateSelect-menuShowing-"+(w?"top":"bottom")),i.bind("click.ultimateSelect",function(l){e(l.target).parents().andSelf().hasClass("ultimateSelect-options")||t.hideMenus()})},n.prototype.hideMenus=function(){0!==e(".ultimateSelect-dropdown-menu:visible").length&&(i.unbind("click.ultimateSelect"),e(".ultimateSelect-dropdown-menu").each(function(){var t=e(this),l=t.data("ultimateSelect-select"),a=l.data("ultimateSelect-settings"),i=t.data("posTop");if(l.triggerHandler("beforeclose"))return!1;var s=function(){l.triggerHandler("close",{_ultimateSelect:!0})};if(a){switch(a.menuTransition){case"fade":t.fadeOut(a.menuSpeed,s);break;case"slide":t.slideUp(a.menuSpeed,s);break;default:t.hide(a.menuSpeed,s)}a.menuSpeed||s();var n=l.data("ultimateSelect-control");n.removeClass("ultimateSelect-menuShowing ultimateSelect-menuShowing-"+(i?"top":"bottom"))}else t.hide(),t.triggerHandler("close",{_ultimateSelect:!0}),t.removeClass("ultimateSelect-menuShowing ultimateSelect-menuShowing-"+(i?"top":"bottom"));t.css("max-height",""),t.removeClass("ultimateSelect-options-"+(i?"top":"bottom")),t.data("posTop",!1)}))},n.prototype.selectOption=function(t,l){var a=e(this.selectElement),i=e(t),s=a.data("ultimateSelect-control");if(s.hasClass("ultimateSelect-disabled"))return!1;if(0===i.length||i.hasClass("ultimateSelect-disabled"))return!1;if(a.attr("multiple"))if(l.shiftKey&&s.data("ultimateSelect-last-selected")){i.toggleClass("ultimateSelect-selected");var n;n=i.index()>s.data("ultimateSelect-last-selected").index()?i.siblings().slice(s.data("ultimateSelect-last-selected").index(),i.index()):i.siblings().slice(i.index(),s.data("ultimateSelect-last-selected").index()),n=n.not(".ultimateSelect-optgroup, .ultimateSelect-disabled"),i.hasClass("ultimateSelect-selected")?n.addClass("ultimateSelect-selected"):n.removeClass("ultimateSelect-selected")}else this.isMac&&l.metaKey||!this.isMac&&l.ctrlKey?i.toggleClass("ultimateSelect-selected"):(i.siblings().removeClass("ultimateSelect-selected"),i.addClass("ultimateSelect-selected"));else i.siblings().removeClass("ultimateSelect-selected"),i.addClass("ultimateSelect-selected");s.hasClass("ultimateSelect-dropdown")&&s.find(".ultimateSelect-label").text(i.text());var o=0,c=[];return a.attr("multiple")?s.find(".ultimateSelect-selected A").each(function(){c[o++]=e(this).attr("rel")}):c=i.find("A").attr("rel"),s.data("ultimateSelect-last-selected",i),a.val()!==c&&(a.val(c),this.setLabel(),a.trigger("change")),!0},n.prototype.getSelectElement=function(){return this.selectElement},n.prototype.keepOptionInView=function(t,l){if(t&&0!==t.length){var a=e(this.selectElement),i=a.data("ultimateSelect-control"),s=i.data("ultimateSelect-options"),n=i.hasClass("ultimateSelect-dropdown")?s:s.parent(),o=parseInt(t.offset().top-n.position().top,10),c=parseInt(o+t.outerHeight(),10);l?n.scrollTop(t.offset().top-n.offset().top+n.scrollTop()-n.height()/2):(0>o&&n.scrollTop(t.offset().top-n.offset().top+n.scrollTop()),c>n.height()&&n.scrollTop(t.offset().top+t.outerHeight()-n.offset().top+n.scrollTop()-n.height()))}},n.prototype.handleKeyDown=function(t){var l=e(this.selectElement),a=l.data("ultimateSelect-control"),i=a.data("ultimateSelect-options"),s=l.data("ultimateSelect-settings"),n=0,o=0;if(!a.hasClass("ultimateSelect-disabled"))switch(t.keyCode){case 8:t.preventDefault(),this.typeSearch="";break;case 9:case 27:this.hideMenus();break;case 13:a.hasClass("ultimateSelect-menuShowing")?(this.selectOption(i.find("LI.ultimateSelect-selected:first"),t),a.hasClass("ultimateSelect-dropdown")&&this.hideMenus()):this.showMenu();break;case 38:case 37:if(t.preventDefault(),a.hasClass("ultimateSelect-menuShowing")){var c=i.find(".ultimateSelect-selected").prev("li");for(n=i.find("LI:not(.ultimateSelect-optgroup)").length,o=0;0===c.length||c.hasClass("ultimateSelect-disabled")||c.hasClass("ultimateSelect-optgroup");){if(c=c.prev("LI"),0===c.length){if(!s.loopOptions)return;c=i.find("LI:last")}if(++o>=n)break}this.selectOption(c,t),this.keepOptionInView(c)}else this.showMenu();break;case 40:case 39:if(t.preventDefault(),a.hasClass("ultimateSelect-menuShowing")){var r=i.find(".ultimateSelect-selected").next("LI");for(n=i.find("li:not(.ultimateSelect-optgroup)").length,o=0;0===r.length||r.hasClass("ultimateSelect-disabled")||r.hasClass("ultimateSelect-optgroup");){if(r=r.next("li"),0===r.length){if(!s.loopOptions)return;r=i.find("li:first")}if(++o>=n)break}this.selectOption(r,t),this.keepOptionInView(r)}else this.showMenu()}},n.prototype.handleKeyPress=function(t){var l=e(this.selectElement),a=l.data("ultimateSelect-control"),i=a.data("ultimateSelect-options"),s=this;if(!a.hasClass("ultimateSelect-disabled"))switch(t.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:a.hasClass("ultimateSelect-menuShowing")||this.showMenu(),t.preventDefault(),clearTimeout(this.typeTimer),this.typeSearch+=String.fromCharCode(t.charCode||t.keyCode),i.find("A").each(function(){return e(this).text().substr(0,s.typeSearch.length).toLowerCase()===s.typeSearch.toLowerCase()?(s.selectOption(e(this).parent(),t),s.keepOptionInView(e(this).parent()),!1):void 0}),this.typeTimer=setTimeout(function(){s.typeSearch=""},1e3)}},n.prototype.enable=function(){var t=e(this.selectElement);t.prop("disabled",!1);var l=t.data("ultimateSelect-control");l&&l.removeClass("ultimateSelect-disabled")},n.prototype.disable=function(){var t=e(this.selectElement);t.prop("disabled",!0);var l=t.data("ultimateSelect-control");l&&l.addClass("ultimateSelect-disabled")},n.prototype.setValue=function(t){var l=e(this.selectElement);l.val(t),t=l.val(),null===t&&(t=l.children().first().val(),l.val(t));var a=l.data("ultimateSelect-control");if(a){var i=l.data("ultimateSelect-settings"),s=a.data("ultimateSelect-options");this.setLabel(),s.find(".ultimateSelect-selected").removeClass("ultimateSelect-selected"),s.find("A").each(function(){var l=e(this);if("object"==typeof t)for(var a=0;a<t.length;a++)l.attr("rel")==t[a]&&l.parent().addClass("ultimateSelect-selected");else l.attr("rel")==t&&l.parent().addClass("ultimateSelect-selected")}),i.change&&i.change.call(l)}},n.prototype.setOptions=function(t){var l=e(this.selectElement),a=l.data("ultimateSelect-control");switch(typeof t){case"string":l.html(t);break;case"object":l.html("");for(var i in t)if(null!==t[i])if("object"==typeof t[i]){var s=e('<optgroup label="'+i+'" />');for(var n in t[i])s.append('<option value="'+n+'">'+t[i][n]+"</option>");l.append(s)}else{var o=e('<option value="'+i+'">'+t[i]+"</option>");l.append(o)}}a&&this.refresh()},n.prototype.disableSelection=function(t){e(t).css("MozUserSelect","none").bind("selectstart",function(e){e.preventDefault()})},n.prototype.generateOptions=function(t,l){var a=e("<li />"),i=e("<a />");a.addClass(t.attr("class")),a.data(t.data());var s=t.text();i.attr("rel",t.val()).text(s),s.length>20&&i.attr("title",s),a.append(i),t.attr("disabled")&&a.addClass("ultimateSelect-disabled"),t.attr("selected")&&a.addClass("ultimateSelect-selected"),l.append(a)},n.prototype.hideSelect=function(){e(this.selectElement).hide()},n.prototype.showSelect=function(){e(this.selectElement).show()},n.prototype.getSettings=function(t){return this._settings={mobile:!0,menuTransition:"slide",menuSpeed:1,loopOptions:!1,topPositionCorrelation:0,bottomPositionCorrelation:0,hideOnWindowScroll:!0,keepInViewport:!0,mobileBehaviour:"native",isMobile:function(){return navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)}},e.extend(!0,this._settings,t)},e.extend(e.fn,{ultimateSelect:function(t,l){var a,i=e(this);switch(t){case"control":return i.data("ultimateSelect-control");case"settings":if(!l)return i.data("ultimateSelect-settings");i.each(function(){var t=e(this),a=e.extend(!0,t.data("ultimateSelect-settings"),l);t.data("ultimateSelect-settings",a)});break;case"options":if(void 0===l)return i.data("ultimateSelect-control").data("ultimateSelect-options");i.each(function(){a=e(this).data("ultimateSelect"),a&&a.setOptions(l)});break;case"value":if(void 0===l)return i.val();i.each(function(){a=e(this).data("ultimateSelect"),a&&a.setValue(l)});break;case"refresh":i.each(function(){a=e(this).data("ultimateSelect"),a&&a.refresh()});break;case"enable":i.each(function(){a=e(this).data("ultimateSelect"),a&&a.enable(this)});break;case"disable":i.each(function(){a=e(this).data("ultimateSelect"),a&&a.disable()});break;case"destroy":i.each(function(){var t=e(this);a=t.data("ultimateSelect"),a&&(a.destroy(),t.data("ultimateSelect",null))});break;case"instance":return i.data("ultimateSelect");default:i.each(function(l,a){var i=e(a);i.data("ultimateSelect")||i.data("ultimateSelect",new n(a,t))})}return i}})}(jQuery,window,document);